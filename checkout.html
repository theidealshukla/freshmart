<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - FreshMart India</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <header class="header container"></header>

    <div class="container breadcrumb" style="margin-top: 1rem;">
        <a href="cart.html">&lt; Back to Cart</a>
    </div>

    <main class="container" style="margin-top: 2rem; margin-bottom: 4rem;">
        <div class="flex flex-col lg:flex-row gap-8" style="display: flex; gap: 2rem;">
            <!-- Left Column: Address & Payment -->
            <div class="flex-1">
                <!-- Step 1: Address -->
                <section class="checkout-step mb-6"
                    style="background:var(--white); border:1px solid var(--border); border-radius:var(--radius-lg); padding:1.5rem;">
                    <div class="step-header flex justify-between mb-4">
                        <h2 class="text-lg font-bold flex items-center gap-2">
                            <span
                                class="step-num flex items-center justify-center bg-green-500 text-white w-6 h-6 rounded-full text-xs"
                                style="background:var(--primary); width:24px; height:24px;">1</span> Delivery Address
                        </h2>
                        <a href="#" class="text-xs text-primary font-bold">+ Add New Address</a>
                    </div>

                    <div class="address-card selected p-4 border rounded-lg cursor-pointer hover:bg-green-50"
                        style="border:2px solid var(--primary); background:rgba(76, 175, 80, 0.05);">
                        <div class="flex justify-between mb-2">
                            <span class="badge bg-green-200 text-green-800 text-xs px-2 py-1 rounded"
                                style="background:#e8f5e9; color:#2e7d32;">Home</span>
                            <span class="text-muted">âœŽ</span>
                        </div>
                        <h3 class="font-bold text-sm">Rahul Sharma</h3>
                        <p class="text-xs text-muted mb-1">Flat 402, Green Heights, MG Road</p>
                        <p class="text-xs text-muted">Indiranagar, Bangalore - 560038</p>
                        <p class="text-xs text-muted mt-2">Mobile: +91 98765 43210</p>
                    </div>
                </section>

                <!-- Step 2: Payment -->
                <section class="checkout-step"
                    style="background:var(--white); border:1px solid var(--border); border-radius:var(--radius-lg); padding:1.5rem;">
                    <div class="step-header mb-4">
                        <h2 class="text-lg font-bold flex items-center gap-2">
                            <span
                                class="step-num flex items-center justify-center bg-gray-300 text-white w-6 h-6 rounded-full text-xs"
                                style="background:#e0e0e0; width:24px; height:24px; color:#757575;">2</span> Payment
                            Method
                        </h2>
                    </div>

                    <div class="tabs flex border-b mb-4 overflow-x-auto">
                        <button
                            class="tab-btn active px-4 py-2 text-sm font-bold border-b-2 border-green-500 text-green-600 whitespace-nowrap"
                            style="color:var(--primary); border-bottom:2px solid var(--primary);">UPI
                            (GPay/PhonePe)</button>
                        <button class="tab-btn px-4 py-2 text-sm text-muted whitespace-nowrap">Credit/Debit
                            Card</button>
                        <button class="tab-btn px-4 py-2 text-sm text-muted whitespace-nowrap">Cash on Delivery</button>
                    </div>

                    <form id="payment-form" class="flex flex-col gap-4">
                        <div>
                            <label class="text-xs text-muted font-bold block mb-1">Enter UPI ID</label>
                            <input type="text" placeholder="e.g. 9876543210@upi" class="w-full p-2 border rounded"
                                style="width:100%; border:1px solid var(--border); border-radius:4px;">
                        </div>
                        <button class="btn btn-outline w-full py-2 text-sm font-bold border-dashed"
                            style="border-style:dashed;">
                            Scan QR Code
                        </button>
                    </form>
                </section>
            </div>

            <!-- Right Column: Summary -->
            <div class="w-full lg:w-80" style="min-width: 320px;">
                <div class="summary-card p-6 bg-green-50 rounded-lg border border-green-100"
                    style="background:var(--light); border:1px solid var(--border); border-radius:var(--radius-lg); padding:1.5rem;">
                    <h2 class="text-lg font-bold mb-4">Bill Summary</h2>
                    <div id="order-items" class="mb-4 text-sm flex flex-col gap-3">
                        <!-- Items injected here -->
                    </div>

                    <hr class="border-t border-gray-200 my-4" style="border-top:1px dashed var(--border);">

                    <div class="flex justify-between mb-2 text-sm">
                        <span class="text-muted">Item Total</span>
                        <span id="checkout-subtotal">â‚¹0.00</span>
                    </div>
                    <div class="flex justify-between mb-2 text-sm">
                        <span class="text-muted">Delivery Fee</span>
                        <span id="checkout-shipping">â‚¹0.00</span>
                    </div>
                    <div class="flex justify-between mb-2 text-sm">
                        <span class="text-muted">Taxes (5%)</span>
                        <span id="checkout-tax">â‚¹0.00</span>
                    </div>
                    <div class="flex justify-between mb-4 text-green-600 font-bold text-sm"
                        style="color:var(--primary);">
                        <span>Discount (FIRST50)</span>
                        <span>-â‚¹50.00</span>
                    </div>

                    <div class="promo-code flex gap-2 mb-6">
                        <input type="text" placeholder="Enter promo code" class="flex-1 p-2 border rounded text-xs"
                            style="border:1px solid var(--border); border-radius:4px;">
                        <button class="bg-gray-200 text-gray-700 px-3 py-1 rounded text-xs font-bold"
                            style="background:#e0e0e0; color:#424242;">APPLY</button>
                    </div>

                    <div class="flex justify-between mb-6 font-bold text-xl">
                        <span>Grand Total</span>
                        <span id="checkout-total">â‚¹0.00</span>
                    </div>

                    <button id="place-order-btn" class="btn btn-primary w-full py-3 shadow-lg" style="width:100%;">
                        Place Order
                    </button>

                    <div class="mt-4 flex items-center justify-center gap-2 text-xs text-muted">
                        <span>âœ“ 100% Secure</span>
                        <span>ðŸšš Fast Delivery</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer container"></footer>

    <script type="module">
        import { cart } from './js/cart.js';

        const orderItemsEl = document.getElementById('order-items');
        const placeOrderBtn = document.getElementById('place-order-btn');

        // Render Checkout Summary
        function renderCheckout() {
            const items = cart.items;
            const totals = cart.getTotals();

            document.getElementById('checkout-subtotal').textContent = `â‚¹${totals.subtotal}`;
            document.getElementById('checkout-tax').textContent = `â‚¹${totals.tax}`;
            document.getElementById('checkout-shipping').textContent = totals.shipping == 0 ? 'Free' : `â‚¹${totals.shipping}`;

            // Applying "mock" discount logic for display
            const discount = 50.00;
            const finalTotal = (parseFloat(totals.total) - discount).toFixed(2);
            document.getElementById('checkout-total').textContent = `â‚¹${finalTotal > 0 ? finalTotal : 0}`;

            orderItemsEl.innerHTML = items.map(item => `
                <div class="flex gap-3">
                    <img src="${item.image}" alt="" class="w-10 h-10 object-cover rounded" style="width:40px; height:40px; border-radius:4px; object-fit:cover;">
                    <div class="flex-1">
                        <div class="flex justify-between">
                            <span class="font-medium text-xs">${item.name}</span>
                            <span class="font-bold text-xs">â‚¹${(item.price * item.qty).toFixed(2)}</span>
                        </div>
                        <div class="text-xs text-muted">Qty: ${item.qty}</div>
                    </div>
                </div>
            `).join('');
        }

        renderCheckout();

        // Simulate Order Placement
        placeOrderBtn.addEventListener('click', () => {
            placeOrderBtn.textContent = 'Processing...';
            placeOrderBtn.disabled = true;

            setTimeout(() => {
                cart.clear();
                window.location.href = 'orders.html?new=true';
            }, 2000);
        });
    </script>
    <script type="module" src="js/main.js"></script>
</body>

</html>