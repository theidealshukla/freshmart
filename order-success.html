<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Order Success - DailyFreshFarm</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link rel="icon" type="image/png" href="assets/logo.png">
    <link rel="stylesheet" href="css/style.css">
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0c831f", // Updated brand color
                        "primary-dark": "#096c19",
                        "background-light": "#f6f8f6",
                        "background-dark": "#102210",
                    },
                    fontFamily: {
                        "display": ["Work Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        /* Custom Confetti Animation */
        @keyframes fall {
            0% {
                transform: translateY(-10vh) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #0c831f;
            animation: fall 4s linear infinite;
            z-index: 0;
            opacity: 0.6;
        }

        .confetti:nth-child(2n) {
            background-color: #102210;
        }

        .confetti:nth-child(3n) {
            background-color: #fbbf24;
        }

        /* Adding a splash of yellow */
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase.js"></script>
</head>

<body
    class="bg-background-light dark:bg-background-dark text-gray-800 dark:text-gray-100 font-display min-h-screen flex flex-col relative overflow-x-hidden transition-colors duration-300 pb-20">
    <!-- Confetti Background Elements -->
    <div aria-hidden="true" class="pointer-events-none absolute inset-0 overflow-hidden">
        <div class="confetti left-[10%] top-[-10%] delay-[0s]"></div>
        <div class="confetti left-[20%] top-[-20%] delay-[1s]"></div>
        <div class="confetti left-[35%] top-[-15%] delay-[2s]"></div>
        <div class="confetti left-[50%] top-[-5%] delay-[0.5s]"></div>
        <div class="confetti left-[65%] top-[-25%] delay-[1.5s]"></div>
        <div class="confetti left-[80%] top-[-10%] delay-[3s]"></div>
        <div class="confetti left-[90%] top-[-30%] delay-[2.5s]"></div>
    </div>
    <nav class="w-full bg-white dark:bg-background-dark border-b border-primary/10 dark:border-white/10 z-20">
        <div class="max-w-7xl mx-auto px-4 py-2">
            <div class="flex justify-between items-center">
                <!-- Logo and Brand Name on Left -->
                <a href="index.html" class="flex items-center">
                    <img src="assets/logo.png" alt="DailyFreshMart" class="h-20 md:h-28 w-auto">
                </a>
                <!-- Search and Cart Icons on Right -->
                <div class="flex items-center gap-3">
                    <button id="search-btn"
                        class="flex h-11 w-11 items-center justify-center rounded-full hover:bg-primary/10 transition-colors">
                        <span class="material-symbols-outlined text-2xl text-gray-900 dark:text-white">search</span>
                    </button>
                    <a href="cart.html"
                        class="relative flex h-11 w-11 items-center justify-center rounded-full hover:bg-primary/10 transition-colors">
                        <span
                            class="material-symbols-outlined text-2xl text-gray-900 dark:text-white">shopping_cart</span>
                        <div id="desk-cart-badge"
                            class="absolute -top-1 -right-1 flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] text-white font-bold">
                            2</div>
                    </a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Main Content -->
    <main class="flex-grow flex items-center justify-center p-4 sm:p-6 lg:p-8 z-10">
        <div
            class="max-w-3xl w-full bg-white dark:bg-[#152e15] rounded-xl shadow-2xl dark:shadow-black/40 overflow-hidden border border-gray-100 dark:border-white/5 relative">
            <!-- Success Hero Section -->
            <div class="text-center pt-12 pb-8 px-8 relative">
                <!-- Abstract BG pattern for header -->
                <div
                    class="absolute top-0 left-0 w-full h-32 bg-gradient-to-b from-primary/10 to-transparent opacity-50">
                </div>
                <div
                    class="relative inline-flex items-center justify-center w-24 h-24 mb-6 bg-primary/20 rounded-full animate-[bounce_1s_ease-out]">
                    <div
                        class="w-16 h-16 bg-primary rounded-full flex items-center justify-center shadow-lg shadow-primary/30">
                        <span class="material-icons text-white text-4xl">check</span>
                    </div>
                    <!-- Ripple effect rings -->
                    <div class="absolute inset-0 rounded-full border-2 border-primary animate-ping opacity-20"></div>
                </div>
                <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white mb-2">Order Placed Successfully!
                </h1>
                <p class="text-gray-500 dark:text-gray-300 text-lg">Thank you for choosing fresh. Your order <span
                        class="font-mono font-medium text-gray-700 dark:text-gray-200">#DFF-88291</span> is confirmed.
                </p>
            </div>
            <div class="px-8 pb-10 space-y-8">
                <!-- Delivery Tracker Card -->
                <div
                    class="bg-background-light dark:bg-background-dark rounded-xl p-6 border border-gray-200 dark:border-white/10 shadow-sm">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                        <div>
                            <p class="text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wide font-semibold">
                                Estimated Delivery</p>
                            <div class="flex items-baseline gap-2 mt-1">
                                <span class="text-3xl font-bold text-gray-900 dark:text-white">12 mins</span>
                                <span class="text-primary-dark dark:text-primary font-medium">On time</span>
                            </div>
                        </div>
                        <div
                            class="flex items-center gap-2 bg-white dark:bg-white/5 px-3 py-1.5 rounded-lg border border-gray-200 dark:border-white/10">
                            <span class="flex h-2 w-2 rounded-full bg-primary animate-pulse"></span>
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-200">Preparing Order</span>
                        </div>
                    </div>
                    <!-- Progress Bar -->
                    <div class="relative mt-4">
                        <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200 dark:bg-gray-700">
                            <div id="progress-fill"
                                class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-500 transition-all duration-1000 ease-out"
                                style="width: 5%">
                            </div>
                        </div>

                        <div class="flex justify-between text-[10px] sm:text-xs font-medium text-gray-500 dark:text-gray-400"
                            id="progress-labels">
                            <div id="step-pending" class="text-yellow-600 font-bold">Pending</div>
                            <div id="step-confirmed">Confirmed</div>
                            <div id="step-packing">Packing</div>
                            <div id="step-delivery">On Way</div>
                            <div id="step-arrived">Delivered</div>
                        </div>
                    </div>
                </div>
                <!-- Order Details Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Address Section -->
                    <div
                        class="flex gap-4 p-4 rounded-lg hover:bg-background-light dark:hover:bg-white/5 transition-colors border border-transparent hover:border-gray-100 dark:hover:border-white/5">
                        <div class="flex-shrink-0">
                            <div
                                class="w-10 h-10 rounded-lg bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400">
                                <span class="material-icons text-xl">home</span>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 dark:text-white mb-1">Home Delivery</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed">
                                402, Green Valley Apartments,<br />
                                Near City Park,<br />
                                Mumbai, MH - 400001
                            </p>
                        </div>
                    </div>
                    <!-- Payment Summary -->
                    <div
                        class="flex gap-4 p-4 rounded-lg hover:bg-background-light dark:hover:bg-white/5 transition-colors border border-transparent hover:border-gray-100 dark:hover:border-white/5">
                        <div class="flex-shrink-0">
                            <div
                                class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400">
                                <span class="material-icons text-xl">receipt</span>
                            </div>
                        </div>
                        <div class="flex-grow">
                            <div class="flex justify-between items-center mb-1">
                                <h3 class="font-semibold text-gray-900 dark:text-white">Payment Summary</h3>
                                <span
                                    class="bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 text-xs px-2 py-0.5 rounded font-medium">Paid</span>
                            </div>
                            <div class="flex justify-between text-sm mt-2">
                                <span class="text-gray-500 dark:text-gray-400" id="success-item-count">Subtotal</span>
                                <span class="text-gray-900 dark:text-white font-medium"
                                    id="success-items-total">₹0.00</span>
                            </div>
                            <div class="flex justify-between text-sm mt-1">
                                <span class="text-gray-500 dark:text-gray-400">Delivery Fee</span>
                                <span class="text-green-600 dark:text-primary text-xs font-semibold">FREE</span>
                            </div>
                            <div
                                class="border-t border-gray-200 dark:border-white/10 mt-2 pt-2 flex justify-between items-center">
                                <span class="font-bold text-gray-900 dark:text-white">Total</span>
                                <span class="font-bold text-lg text-gray-900 dark:text-white"
                                    id="success-grand-total">₹0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Decor bottom -->
                <div class="h-2 w-full bg-gradient-to-r from-primary via-green-400 to-primary"></div>
            </div>
            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 p-6 bg-gray-50 dark:bg-white/5">
                <button onclick="window.location.href='orders.html'"
                    class="flex-1 bg-primary hover:bg-primary-dark text-white font-bold py-4 px-6 rounded-lg shadow-lg shadow-primary/20 transform transition hover:-translate-y-0.5 focus:ring-4 focus:ring-primary/40 focus:outline-none flex justify-center items-center gap-2">
                    <span class="material-icons text-xl">map</span>
                    Track Order
                </button>
                <button onclick="window.location.href='index.html'"
                    class="flex-1 bg-transparent hover:bg-gray-100 dark:hover:bg-white/10 text-gray-700 dark:text-white border-2 border-gray-200 dark:border-gray-600 font-bold py-4 px-6 rounded-lg transition-colors focus:ring-4 focus:ring-gray-100 dark:focus:ring-gray-700 focus:outline-none">
                    Back to Home
                </button>
            </div>
        </div>
    </main>
    <!-- Footer Simple -->
    <footer class="py-6 text-center text-gray-400 dark:text-gray-600 text-sm z-10">
        <p>© 2024 DailyFreshFarm. Freshness Delivered.</p>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // 1. Get Order Data
            const orderDataStr = localStorage.getItem('last_order');
            if (!orderDataStr) return;

            const orderData = JSON.parse(orderDataStr);
            const orderId = orderData.orderId;

            // Render Initial Data
            document.querySelector('.font-mono').textContent = '#' + orderId;
            document.getElementById('success-grand-total').textContent = `₹${orderData.total.toFixed(2)}`;
            document.getElementById('success-items-total').textContent = `₹${orderData.subtotal.toFixed(2)}`;
            document.getElementById('success-item-count').textContent = `Subtotal (${orderData.itemCount} items)`;

            // 2. LIVE TRACKING LOGIC
            function updateUI(status) {
                console.log("Live Update Received:", status);

                const progressBar = document.getElementById('progress-fill');
                const statusText = document.querySelector('.text-sm.font-medium.text-gray-700.dark\\:text-gray-200'); // Top right status badge text

                // Reset all labels to gray first
                ['pending', 'confirmed', 'packing', 'delivery', 'arrived'].forEach(step => {
                    const el = document.getElementById('step-' + step);
                    if (el) el.className = "text-gray-500 dark:text-gray-400";
                });

                // Helper to highlight a label
                const highlight = (id, colorClass) => {
                    const el = document.getElementById(id);
                    if (el) el.className = `${colorClass} font-bold transform scale-110 transition-transform`;
                };

                // 1. PENDING (Step 1)
                if (status === 'Pending') {
                    progressBar.style.width = '10%';
                    progressBar.className = "shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-500 animate-pulse";
                    if (statusText) statusText.textContent = 'Pending Confirmation';
                    highlight('step-pending', 'text-yellow-600 dark:text-yellow-400');
                }

                // 2. CONFIRMED (Step 2)
                else if (status === 'Confirmed') {
                    progressBar.style.width = '30%';
                    progressBar.className = "shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-primary";
                    if (statusText) statusText.textContent = 'Order Confirmed';
                    highlight('step-confirmed', 'text-primary-dark dark:text-primary');
                }

                // 3. PACKING (Step 3)
                else if (status === 'Packing') {
                    progressBar.style.width = '55%';
                    progressBar.className = "shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-primary";
                    if (statusText) statusText.textContent = 'Being Packed';
                    highlight('step-packing', 'text-primary-dark dark:text-primary');
                }

                // 4. OUT FOR DELIVERY (Step 4)
                else if (status === 'Out for Delivery') {
                    progressBar.style.width = '80%';
                    progressBar.className = "shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-primary";
                    if (statusText) statusText.textContent = 'Out for Delivery';
                    highlight('step-delivery', 'text-primary-dark dark:text-primary');
                }

                // 5. DELIVERED (Step 5)
                else if (status === 'Delivered' || status === 'Arrived') {
                    progressBar.style.width = '100%';
                    progressBar.className = "shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-green-600";
                    if (statusText) statusText.textContent = 'Delivered';
                    highlight('step-arrived', 'text-green-700 dark:text-green-400');
                }

                // CANCELLED
                else if (status === 'Cancelled') {
                    progressBar.style.width = '100%';
                    progressBar.className = "shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-red-600";
                    if (statusText) statusText.textContent = 'Order Cancelled';
                    highlight('step-pending', 'text-red-600'); // Highlight start as red
                }
            }

            // 3. LISTEN TO SUPABASE
            window.supabaseClient
                .channel('public:orders:' + orderId)
                .on('postgres_changes',
                    { event: 'UPDATE', schema: 'public', table: 'orders', filter: `id=eq.${orderId}` },
                    (payload) => {
                        updateUI(payload.new.status);
                    }
                )
                .subscribe();
        });
    </script>

    <!-- Search Modal -->
    <div id="search-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/50" id="search-overlay"></div>
        <div
            class="relative bg-white dark:bg-background-dark w-full max-w-2xl mx-auto mt-20 rounded-2xl shadow-2xl overflow-hidden">
            <div class="flex items-center gap-3 p-4 border-b border-gray-200 dark:border-gray-700">
                <span class="material-symbols-outlined text-gray-400">search</span>
                <input id="search-input" type="text" placeholder="Search for groceries, fruits, vegetables..."
                    class="flex-1 bg-transparent border-none text-lg focus:outline-none focus:ring-0 text-gray-900 dark:text-white placeholder-gray-400"
                    autofocus>
                <button id="search-close"
                    class="p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors">
                    <span class="material-symbols-outlined text-gray-500">close</span>
                </button>
            </div>
            <div class="p-4">
                <p class="text-sm text-gray-500 mb-3">Popular searches</p>
                <div class="flex flex-wrap gap-2">
                    <a href="category.html?search=milk"
                        class="px-3 py-1.5 bg-gray-100 dark:bg-gray-800 rounded-full text-sm text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white transition-colors">Milk</a>
                    <a href="category.html?search=bread"
                        class="px-3 py-1.5 bg-gray-100 dark:bg-gray-800 rounded-full text-sm text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white transition-colors">Bread</a>
                    <a href="category.html?search=eggs"
                        class="px-3 py-1.5 bg-gray-100 dark:bg-gray-800 rounded-full text-sm text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white transition-colors">Eggs</a>
                    <a href="category.html?search=fruits"
                        class="px-3 py-1.5 bg-gray-100 dark:bg-gray-800 rounded-full text-sm text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white transition-colors">Fruits</a>
                    <a href="category.html?search=snacks"
                        class="px-3 py-1.5 bg-gray-100 dark:bg-gray-800 rounded-full text-sm text-gray-700 dark:text-gray-300 hover:bg-primary hover:text-white transition-colors">Snacks</a>
                </div>
            </div>
        </div>
    </div>
    <script>
        (function () {
            const searchBtn = document.getElementById('search-btn');
            const searchModal = document.getElementById('search-modal');
            const searchClose = document.getElementById('search-close');
            const searchOverlay = document.getElementById('search-overlay');
            const searchInput = document.getElementById('search-input');
            if (searchBtn && searchModal) {
                searchBtn.addEventListener('click', () => { searchModal.classList.remove('hidden'); searchInput.focus(); });
                searchClose.addEventListener('click', () => { searchModal.classList.add('hidden'); });
                searchOverlay.addEventListener('click', () => { searchModal.classList.add('hidden'); });
                searchInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && searchInput.value.trim()) window.location.href = `category.html?search=${encodeURIComponent(searchInput.value.trim())}`;
                    if (e.key === 'Escape') searchModal.classList.add('hidden');
                });
            }
        })();
    </script>

    <!-- Bottom Nav -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <svg viewBox="0 0 24 24">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span>Home</span>
        </a>
        <a href="category.html" class="nav-item">
            <svg viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <span>Search</span>
        </a>
        <a href="cart.html" class="nav-item relative">
            <div style="position: relative;">
                <svg viewBox="0 0 24 24">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                </svg>
                <span id="nav-badge" class="hidden"
                    style="position: absolute; top: -5px; right: -8px; background: var(--primary); color: white; font-size: 0.6rem; padding: 2px 4px; border-radius: 10px; min-width: 16px; text-align: center;">0</span>
            </div>
            <span>Cart</span>
        </a>
        <a href="orders.html" class="nav-item">
            <svg viewBox="0 0 24 24">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span>Orders</span>
        </a>
        <a href="profile.html" class="nav-item">
            <svg viewBox="0 0 24 24">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Profile</span>
        </a>
    </nav>
</body>

</html>