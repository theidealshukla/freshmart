<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>My Cart - Daily FarmFresh</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body style="background: #f4f6fb;">

    <header></header>

    <main class="container" style="margin-top: 2rem; margin-bottom: 6rem; min-height: 60vh;">
        <h1 class="text-xl font-bold mb-4">My Cart</h1>

        <div class="flex flex-col lg:flex-row gap-6">
            
            <div class="flex-1" id="cart-items-container">
                </div>

            <div class="cart-summary" style="min-width: 340px;">
                <div class="bill-card">
                    <h2 class="text-sm font-bold mb-3">Bill Details</h2>
                    
                    <div class="bill-row">
                        <span>MRP Total</span>
                        <span id="bill-mrp">₹0</span>
                    </div>
                    <div class="bill-row">
                        <span>Product Discount</span>
                        <span class="text-primary" id="bill-discount">- ₹0</span>
                    </div>
                    <div class="bill-row">
                        <span>Delivery Charge</span>
                        <span class="text-primary">FREE</span>
                    </div>
                    
                    <div class="bill-row total">
                        <span>Grand Total</span>
                        <span id="bill-total">₹0</span>
                    </div>
                </div>

                <div class="savings-strip" id="savings-strip">
                    <span>🏷️</span> You are saving ₹<span id="savings-amt">0</span> on this order
                </div>

                <a href="checkout.html" class="btn-pay w-full justify-center hidden lg:flex" style="text-align:center;">
                    Proceed to Pay
                </a>
            </div>
        </div>
    </main>

    <div class="bottom-pay-bar lg:hidden">
        <div class="flex flex-col">
            <span class="text-xs font-bold uppercase text-muted">Total</span>
            <span class="text-lg font-bold" id="mobile-total">₹0</span>
        </div>
        <a href="checkout.html" class="btn-pay">
            Proceed
            <span>→</span>
        </a>
    </div>

    <script type="module">
        import { cart } from './js/cart.js';

        const container = document.getElementById('cart-items-container');
        const els = {
            mrp: document.getElementById('bill-mrp'),
            discount: document.getElementById('bill-discount'),
            total: document.getElementById('bill-total'),
            savings: document.getElementById('savings-amt'),
            mobileTotal: document.getElementById('mobile-total'),
            savingsStrip: document.getElementById('savings-strip')
        };

        function renderCart() {
            const items = cart.items;
            const totals = cart.getTotals(); // You might need to adjust logic if getTotals() returns flat numbers
            
            // 1. Calculations (Mocking MRP logic since data might not have it strictly)
            const payTotal = parseFloat(totals.total);
            const mrpTotal = (payTotal * 1.2).toFixed(2); // Fake 20% markup for display
            const savings = (mrpTotal - payTotal).toFixed(2);

            // 2. Render Items
            if (items.length === 0) {
                container.innerHTML = `
                    <div class="empty-cart bg-white rounded-lg border p-8">
                        <div style="font-size:3rem; margin-bottom:1rem;">🛒</div>
                        <h3 class="font-bold text-lg">Your cart is empty</h3>
                        <p class="text-muted mb-4">Add items to start your shopping</p>
                        <a href="index.html" class="btn-pay" style="display:inline-block; padding:0.5rem 1rem; font-size:0.9rem;">Browse Products</a>
                    </div>
                `;
                document.querySelector('.cart-summary').style.display = 'none';
                document.querySelector('.bottom-pay-bar').style.display = 'none';
                return;
            }

            container.innerHTML = items.map(item => `
                <div class="cart-item">
                    <img src="${item.image}" class="cart-img" alt="${item.name}">
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="font-semibold text-sm mb-1">${item.name}</h3>
                                <div class="text-xs text-muted mb-2">${item.weight || item.unit}</div>
                                <div class="font-bold">₹${item.price} <span class="text-xs text-muted line-through font-normal">₹${item.mrp || (item.price*1.2).toFixed(0)}</span></div>
                            </div>
                            <div class="qty-counter">
                                <button class="qty-btn" onclick="window.updateCartQty(${item.id}, -1)">-</button>
                                <span class="qty-val">${item.qty}</span>
                                <button class="qty-btn" onclick="window.updateCartQty(${item.id}, 1)">+</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            // 3. Update Bill
            els.mrp.textContent = `₹${mrpTotal}`;
            els.discount.textContent = `- ₹${savings}`;
            els.total.textContent = `₹${payTotal}`;
            els.mobileTotal.textContent = `₹${payTotal}`;
            els.savings.textContent = savings;
        }

        // Global handlers for onclick
        window.updateCartQty = (id, delta) => {
            cart.updateQty(id, delta);
            renderCart();
        };

        renderCart();
        window.addEventListener('cart-updated', renderCart);
    </script>
    <script type="module" src="js/main.js"></script>
</body>
</html>
